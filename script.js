// Kelime listesi
const words = [
    { german: "Hallo", turkish: "Merhaba" },
    { german: "Guten Morgen", turkish: "G√ºnaydƒ±n" },
    { german: "Guten Tag", turkish: "ƒ∞yi g√ºnler" },
    { german: "Guten Abend", turkish: "ƒ∞yi ak≈üamlar" },
    { german: "Gute Nacht", turkish: "ƒ∞yi geceler" },
    { german: "Auf Wiedersehen", turkish: "Ho≈ü√ßa kalƒ±n" },
    { german: "Ja", turkish: "Evet" },
    { german: "Nein", turkish: "Hayƒ±r" },
    { german: "Danke", turkish: "Te≈üekk√ºr ederim" },
    { german: "Bitte", turkish: "Rica ederim" },
    { german: "eins", turkish: "bir" },
    { german: "zwei", turkish: "iki" },
    { german: "drei", turkish: "√º√ß" },
    { german: "vier", turkish: "d√∂rt" },
    { german: "f√ºnf", turkish: "be≈ü" },
    { german: "sechs", turkish: "altƒ±" },
    { german: "sieben", turkish: "yedi" },
    { german: "acht", turkish: "sekiz" },
    { german: "neun", turkish: "dokuz" },
    { german: "zehn", turkish: "on" },
    { german: "der Vater", turkish: "baba" },
    { german: "die Mutter", turkish: "anne" },
    { german: "der Sohn", turkish: "oƒüul" },
    { german: "die Tochter", turkish: "kƒ±z evlat" },
    { german: "der Bruder", turkish: "erkek karde≈ü" },
    { german: "die Schwester", turkish: "kƒ±z karde≈ü" },
    { german: "der Opa", turkish: "dede" },
    { german: "die Oma", turkish: "nine" },
    { german: "das Baby", turkish: "bebek" },
    { german: "das Haus", turkish: "ev" },
    { german: "das Auto", turkish: "araba" },
    { german: "der Bus", turkish: "otob√ºs" },
    { german: "der Zug", turkish: "tren" },
    { german: "das Flugzeug", turkish: "u√ßak" }
];

// Oyun durumu
let currentWordIndex = 0;
let isFlipped = false;
let knownWordsCount = 0;
let unknownWordsCount = 0;

// DOM elementleri
const flashcard = document.getElementById("flashcard");
const germanWord = document.getElementById("german-word");
const turkishWord = document.getElementById("turkish-word");
const currentCardSpan = document.getElementById("current-card");
const totalCardsSpan = document.getElementById("total-cards");
const shuffleBtn = document.getElementById("shuffle-btn");
const knownBtn = document.getElementById("known-btn");
const unknownBtn = document.getElementById("unknown-btn");
const knownCountSpan = document.getElementById("known-count");
const unknownCountSpan = document.getElementById("unknown-count");
const progressFill = document.getElementById("progress-fill");
const confettiContainer = document.getElementById("confetti-container");
const starsContainer = document.getElementById("stars-container");

// Ses efektleri (Web Audio API kullanarak)
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

function playFlipSound() {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
}

function playSuccessSound() {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.setValueAtTime(523, audioContext.currentTime); // C5
    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1); // E5
    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2); // G5
    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.3);
}

// Kartƒ± g√ºncelle
function updateCard() {
    const currentWord = words[currentWordIndex];
    germanWord.textContent = currentWord.german;
    turkishWord.textContent = currentWord.turkish;
    currentCardSpan.textContent = currentWordIndex + 1;
    totalCardsSpan.textContent = words.length;
    knownCountSpan.textContent = knownWordsCount;
    unknownCountSpan.textContent = unknownWordsCount;

    // Progress bar g√ºncelle
    const progress = ((currentWordIndex + 1) / words.length) * 100;
    progressFill.style.width = progress + "%";

    // Buton durumlarƒ±nƒ± g√ºncelle
    shuffleBtn.disabled = false; // Shuffle butonu her zaman aktif
    knownBtn.disabled = true; // Ba≈ülangƒ±√ßta pasif
    unknownBtn.disabled = true; // Ba≈ülangƒ±√ßta pasif

    // Kartƒ± √∂n y√ºze √ßevir
    flashcard.classList.remove("flipped");
    isFlipped = false;
}

// Kartƒ± √ßevir
function flipCard() {
    if (!isFlipped) {
        flashcard.classList.add("flipped");
        isFlipped = true;
        playFlipSound();
        knownBtn.disabled = false;
        unknownBtn.disabled = false;
        setTimeout(() => {
            showStars();
            if (Math.random() < 0.3) {
                showConfetti();
                playSuccessSound();
            }
        }, 400);
    }
}

// Sonraki kart
function nextCard() {
    if (currentWordIndex < words.length - 1) {
        currentWordIndex++;
        updateCard();
    } else {
        alert("Tebrikler! T√ºm kelimeleri tamamladƒ±nƒ±z!");
    }
}

// Kartlarƒ± karƒ±≈ütƒ±r
function shuffleCards() {
    for (let i = words.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [words[i], words[j]] = [words[j], words[i]];
    }
    currentWordIndex = 0;
    updateCard();
    showConfetti();
    playSuccessSound();
}

// Kelimeyi biliyorum
function markAsKnown() {
    if (isFlipped) {
        if (!words[currentWordIndex].known) {
            words[currentWordIndex].known = true;
            knownWordsCount++;
        }
        nextCard();
    }
}

// Kelimeyi bilmiyorum
function markAsUnknown() {
    if (isFlipped) {
        if (!words[currentWordIndex].unknown) {
            words[currentWordIndex].unknown = true;
            unknownWordsCount++;
        }
        nextCard();
    }
}

// Konfeti animasyonu
function showConfetti() {
    const colors = ["#ff6b6b", "#feca57", "#48cae4", "#ff9ff3", "#54a0ff"];
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "%";
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 2 + "s";
            confettiContainer.appendChild(confetti);
            setTimeout(() => {
                confetti.remove();
            }, 3000);
        }, i * 50);
    }
}

// Yƒ±ldƒ±z animasyonu
function showStars() {
    const starEmojis = ["‚≠ê", "üåü", "‚ú®", "üí´"];
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
            const star = document.createElement("div");
            star.className = "star";
            star.textContent = starEmojis[Math.floor(Math.random() * starEmojis.length)];
            star.style.left = Math.random() * 100 + "%";
            star.style.top = Math.random() * 100 + "%";
            starsContainer.appendChild(star);
            setTimeout(() => {
                star.remove();
            }, 2000);
        }, i * 200);
    }
}

// Event listeners
flashcard.addEventListener("click", flipCard);
shuffleBtn.addEventListener("click", shuffleCards);
knownBtn.addEventListener("click", markAsKnown);
unknownBtn.addEventListener("click", markAsUnknown);

// Klavye kontrolleri
document.addEventListener("keydown", (e) => {
    switch (e.key) {
        case " ":
        case "Enter":
            e.preventDefault();
            flipCard();
            break;
        case "s":
        case "S":
            shuffleCards();
            break;
        case "k":
        case "K":
            markAsKnown();
            break;
        case "u":
        case "U":
            markAsUnknown();
            break;
    }
});

// Touch events for mobile
let touchStartX = 0;
let touchEndX = 0;

flashcard.addEventListener("touchstart", (e) => {
    touchStartX = e.changedTouches[0].screenX;
});

flashcard.addEventListener("touchend", (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    const swipeThreshold = 50;
    const diff = touchStartX - touchEndX;
    if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
            // sola kaydƒ±rma (nextCard otomatik ge√ßi≈üte var)
        } else {
            // saƒüa kaydƒ±rma (isteƒüe baƒülƒ± eski karta gitme eklenebilir)
        }
    }
}

// ƒ∞lk kartƒ± y√ºkle
updateCard();

// Ho≈ü geldin animasyonu
setTimeout(() => {
    showStars();
}, 1000);